const base64=require("base-64");console.log(process.argv);var parts=base64.decode(process.argv[2]).split(":"),token="";console.log(new Date().getTime()-+parts[0]),5e3>new Date().getTime()-+parts[0]&&(token=base64.decode(parts[1]));const Discord=require("discord.js"),embeds=require("./embeds.min.js"),client=new Discord.Client,command=require("./cx5.min.js"),c=command.c;var fs=require("fs");const core="476905356723748867",ghostly="393543627227267073";function read(a){try{var b=fs.readFileSync(a);return b}catch(a){return null}}function write(a,b){fs.writeFileSync("./"+a,b,{flag:"w+"})}function parseData(a){return JSON.parse(base64.decode(a))}function writeField(a,b,c){var d=Number.isInteger;try{var e=base64.decode(JSON.parse(read(a)).data)}catch(a){return null}console.log(e);var f=new RegExp("\""+b+"\":\"?[a-zA-Z\\[\\]#0-9]+\"?","g"),g=e.match(f),h=e.indexOf(g[0]);e=e.replace(g+",",""),e="giveaways"==b?e.slice(0,h)+"\""+b+"\":["+c+"],"+e.slice(h):d(c)?e.slice(0,h)+"\""+b+"\":"+c+","+e.slice(h):e.slice(0,h)+"\""+b+"\":\""+c+"\","+e.slice(h),console.log(e);var i=base64.encode(e);return write(a,"{\n\t\"data\":\""+i+"\"\n}"),0}client.on("message",a=>{command.parseCommand(a)}),c.on("help",(a,b)=>{console.log("Help"),b.channel.send(embeds.helpEmbed)}),c.on("log",(a,b)=>{console.log("Log");try{var c=require("./database/"+a[1].toLowerCase()+".json");Object.keys(require.cache).forEach(function(a){delete require.cache[a]});var d=parseData(c.data),f="",g="",h="";"co"===d.rank?(f="Co-Owner",g="#FFFF55"):"res"==d.rank?(f="Resident",g="#FFAA00"):"guest"==d.rank?(f="Guest",g="#AAAAAA"):"owner"==d.rank&&(f="Owner",g="#AA0000"),1==d.developer&&(h+=":diamond_shape_with_a_dot_inside:"),1==d.moderator&&(h+=":small_orange_diamond:"),1==d.owner&&(h+=":infinity:"),b.channel.send(embeds.playerInfo(h+" "+a[1].toLowerCase(),f,d.usedskips,d.skipsleft,d.discord,d.giveaways,g))}catch(i){console.log(i),write("./database/"+a[1].toLowerCase()+".json","{\n\t\"data\": \""+base64.encode("{\"version\":3,\"rank\":\"guest\",\"usedskips\":0,\"skipsleft\":1,\"discord\":\"unset\",\"giveaways\":[\"none\"],\"developer\":0,\"moderator\":0,\"owner\":0,\"vip\":0,\"badge\":\"\"}")+"\"\n}");var c=require("./database/"+a[1].toLowerCase()+".json");Object.keys(require.cache).forEach(function(a){delete require.cache[a]});var d=parseData(c.data),f="",g="",h="";"co"===d.rank?(f="Co-Owner",g="#FFFF55"):"res"==d.rank?(f="Resident",g="#FFAA00"):"guest"==d.rank?(f="Guest",g="#AAAAAA"):"owner"==d.rank&&(f="Owner",g="#AA0000"),1==d.developer&&(h+=":diamond_shape_with_a_dot_inside:"),1==d.moderator&&(h+=":small_orange_diamond:"),1==d.owner&&(h+=":infinity:"),b.channel.send(embeds.playerInfo(h+" "+a[1].toLowerCase(),f,d.usedskips,d.skipsleft,d.discord,d.giveaways,g))}}),c.on("skip",(a,b)=>{console.log("Skip");var c=require("./database/"+a[1]+".json");Object.keys(require.cache).forEach(function(a){delete require.cache[a]});var d=parseData(c.data);0<d.skipsleft?(writeField("./database/"+a[1].toLowerCase()+".json","skipsleft",--d.skipsleft),writeField("./database/"+a[1].toLowerCase()+".json","usedskips",++d.usedskips),b.channel.send(embeds.skipSuccess(a[1],d.usedskips+1,d.skipsleft-1))):b.channel.send(embeds.skipFailed(a[1],d.usedskips,d.skipsleft))}),c.on("hello",(a,b)=>{console.log("Hello"),b.reply("Hello! I'm Chris's Gatekeeper. Type .help for help!")}),c.on("pskipadd",a=>{console.log("Player skip add");var b=require("./database/"+a[1]+".json");Object.keys(require.cache).forEach(function(a){delete require.cache[a]});var c=parseData(b.data);writeField("./database/"+a[1].toLowerCase()+".json","skipsleft",++c.skipsleft)}),c.on("pskipremove",a=>{console.log("Player skip remove");var b=require("./database/"+a[1]+".json");Object.keys(require.cache).forEach(function(a){delete require.cache[a]});var c=parseData(b.data);writeField("./database/"+a[1].toLowerCase()+".json","skipsleft",--c.skipsleft)}),c.on("pdiscordset",a=>{console.log("Player discord set"),writeField("/database/"+a[1]+".json","discord",a[4])}),c.on("prankset",a=>{console.log("Player rank set"),console.log("Player skip remove");var b=require("./database/"+a[1]+".json");Object.keys(require.cache).forEach(function(a){delete require.cache[a]});parseData(b.data);switch(a[4].toLowerCase()){case"guest":writeField("./database/"+a[1].toLowerCase()+".json","rank","guest");break;case"res":writeField("./database/"+a[1].toLowerCase()+".json","rank","res");break;case"co":writeField("./database/"+a[1].toLowerCase()+".json","rank","co");}}),c.on("dgar",(a,b)=>{b.guild.member(b.author).roles.add("751941550933803169"),b.delete()}),c.on("reset",(a,b)=>{try{var c=require("./database/"+a[1]+".json");Object.keys(require.cache).forEach(function(a){delete require.cache[a]});parseData(c.data);b.reply("WARNING! You are about to completley wipe **"+a[1]+"**'s data and rebuild the profile! Type .confirmdel "+a[1]+" to continue! WARNING!")}catch(a){b.reply("Cannot wipe user that does not exist!"),console.log(a)}}),c.on("del",(a,b)=>{try{var c=require("./database/"+a[1]+".json");Object.keys(require.cache).forEach(function(a){delete require.cache[a]});parseData(c.data);b.reply("Please wait, wiping data"),write("./database/"+a[1]+".json",""),b.reply("Wipe complete"),b.reply("Deleting file"),b.reply("File deleted"),b.reply("Rebuilding with default data"),write("./database/"+a[1]+".json","{\n\t\"data\": \""+base64.encode("{\"version\":3,\"rank\":\"guest\",\"usedskips\":0,\"skipsleft\":1,\"discord\":\"unset\",\"giveaways\":[\"none\"],\"developer\":0,\"moderator\":0,\"owner\":0,\"vip\":0}")+"\"\n}"),b.reply("Reset complete.")}catch(a){b.reply("Cannot wipe user that does not exist!"),console.log(a)}}),c.on("write",(a,b)=>{4>a.length&&b.reply("You need more arguments");for(var c=2;c<a.length;c+=2)isNaN(a[c+1])?null==writeField("./database/"+a[1].toLowerCase()+".json",a[c],a[c+1])&&b.reply("That user doesn't exist"):null==writeField("./database/"+a[1].toLowerCase()+".json",a[c],+a[c+1])&&b.reply("That user doesn't exist")}),client.on("ready",()=>{console.log("Logged in")}),client.login(token);