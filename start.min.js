const base64=require("base-64");console.log(process.argv);var parts=base64.decode(process.argv[2]).split(":"),token="";console.log((new Date).getTime()-Number(parts[0])),(new Date).getTime()-Number(parts[0])<5e3&&(token=base64.decode(parts[1]));const Discord=require("discord.js"),embeds=require("./embeds.js"),client=new Discord.Client,command=require("./cx5.js"),c=command.c;var fs=require("fs");const core="476905356723748867",ghostly="393543627227267073";function read(path){try{var contents;return fs.readFileSync(path)}catch(e){return null}}function write(path,text){fs.writeFileSync("./"+path,text,{flag:"w+"})}function parseData(text){return JSON.parse(base64.decode(text))}function writeField(path,field,value){try{var data=base64.decode(JSON.parse(read(path)).data)}catch(e){return null}console.log(data);var pattern,regex=new RegExp('"'+field+'":"?[a-zA-Z\\[\\]#0-9]+"?',"g"),substr=data.match(regex),index=data.indexOf(substr[0]),encoded;return data=data.replace(substr+",",""),data="giveaways"==field?data.slice(0,index)+'"'+field+'":['+value+"],"+data.slice(index):Number.isInteger(value)?data.slice(0,index)+'"'+field+'":'+value+","+data.slice(index):data.slice(0,index)+'"'+field+'":"'+value+'",'+data.slice(index),console.log(data),write(path,'{\n\t"data":"'+base64.encode(data)+'"\n}'),0}client.on("message",msg=>{command.parseCommand(msg)}),c.on("help",(tokens,msg)=>{console.log("Help"),msg.channel.send(embeds.helpEmbed)}),c.on("log",(tokens,msg)=>{console.log("Log");try{var file=require("./database/"+tokens[1].toLowerCase()+".json");Object.keys(require.cache).forEach((function(key){delete require.cache[key]}));var object=parseData(file.data),rank="",color="",prefix="";"co"===object.rank?(rank="Co-Owner",color="#FFFF55"):"res"==object.rank?(rank="Resident",color="#FFAA00"):"guest"==object.rank?(rank="Guest",color="#AAAAAA"):"owner"==object.rank&&(rank="Owner",color="#AA0000"),1==object.developer&&(prefix+=":diamond_shape_with_a_dot_inside:"),1==object.moderator&&(prefix+=":small_orange_diamond:"),1==object.owner&&(prefix+=":infinity:"),msg.channel.send(embeds.playerInfo(prefix+" "+tokens[1].toLowerCase(),rank,object.usedskips,object.skipsleft,object.discord,object.giveaways,color))}catch(e){console.log(e),write("./database/"+tokens[1].toLowerCase()+".json",'{\n\t"data": "'+base64.encode('{"version":3,"rank":"guest","usedskips":0,"skipsleft":1,"discord":"unset","giveaways":["none"],"developer":0,"moderator":0,"owner":0,"vip":0,"badge":""}')+'"\n}');var file=require("./database/"+tokens[1].toLowerCase()+".json");Object.keys(require.cache).forEach((function(key){delete require.cache[key]}));var object,rank="",color="",prefix="";"co"===(object=parseData(file.data)).rank?(rank="Co-Owner",color="#FFFF55"):"res"==object.rank?(rank="Resident",color="#FFAA00"):"guest"==object.rank?(rank="Guest",color="#AAAAAA"):"owner"==object.rank&&(rank="Owner",color="#AA0000"),1==object.developer&&(prefix+=":diamond_shape_with_a_dot_inside:"),1==object.moderator&&(prefix+=":small_orange_diamond:"),1==object.owner&&(prefix+=":infinity:"),msg.channel.send(embeds.playerInfo(prefix+" "+tokens[1].toLowerCase(),rank,object.usedskips,object.skipsleft,object.discord,object.giveaways,color))}}),c.on("skip",(tokens,msg)=>{console.log("Skip");var file=require("./database/"+tokens[1]+".json");Object.keys(require.cache).forEach((function(key){delete require.cache[key]}));var object=parseData(file.data);object.skipsleft>0?(writeField("./database/"+tokens[1].toLowerCase()+".json","skipsleft",--object.skipsleft),writeField("./database/"+tokens[1].toLowerCase()+".json","usedskips",++object.usedskips),msg.channel.send(embeds.skipSuccess(tokens[1],object.usedskips+1,object.skipsleft-1))):msg.channel.send(embeds.skipFailed(tokens[1],object.usedskips,object.skipsleft))}),c.on("hello",(tokens,msg)=>{console.log("Hello"),msg.reply("Hello! I'm Chris's Gatekeeper. Type .help for help!")}),c.on("pskipadd",(tokens,msg)=>{console.log("Player skip add");var file=require("./database/"+tokens[1]+".json");Object.keys(require.cache).forEach((function(key){delete require.cache[key]}));var object=parseData(file.data);writeField("./database/"+tokens[1].toLowerCase()+".json","skipsleft",++object.skipsleft)}),c.on("pskipremove",(tokens,msg)=>{console.log("Player skip remove");var file=require("./database/"+tokens[1]+".json");Object.keys(require.cache).forEach((function(key){delete require.cache[key]}));var object=parseData(file.data);writeField("./database/"+tokens[1].toLowerCase()+".json","skipsleft",--object.skipsleft)}),c.on("pdiscordset",(tokens,msg)=>{console.log("Player discord set"),writeField("/database/"+tokens[1]+".json","discord",tokens[4])}),c.on("prankset",(tokens,msg)=>{console.log("Player rank set"),console.log("Player skip remove");var file=require("./database/"+tokens[1]+".json");Object.keys(require.cache).forEach((function(key){delete require.cache[key]}));var object=parseData(file.data);switch(tokens[4].toLowerCase()){case"guest":writeField("./database/"+tokens[1].toLowerCase()+".json","rank","guest");break;case"res":writeField("./database/"+tokens[1].toLowerCase()+".json","rank","res");break;case"co":writeField("./database/"+tokens[1].toLowerCase()+".json","rank","co")}}),c.on("dgar",(tokens,msg)=>{msg.guild.member(msg.author).roles.add("751941550933803169"),msg.delete()}),c.on("reset",(tokens,msg)=>{try{var file=require("./database/"+tokens[1]+".json");Object.keys(require.cache).forEach((function(key){delete require.cache[key]}));var object=parseData(file.data);msg.reply("WARNING! You are about to completley wipe **"+tokens[1]+"**'s data and rebuild the profile! Type .confirmdel "+tokens[1]+" to continue! WARNING!")}catch(e){msg.reply("Cannot wipe user that does not exist!"),console.log(e)}}),c.on("del",(tokens,msg)=>{try{var file=require("./database/"+tokens[1]+".json");Object.keys(require.cache).forEach((function(key){delete require.cache[key]}));var object=parseData(file.data);msg.reply("Please wait, wiping data"),write("./database/"+tokens[1]+".json",""),msg.reply("Wipe complete"),msg.reply("Deleting file"),msg.reply("File deleted"),msg.reply("Rebuilding with default data"),write("./database/"+tokens[1]+".json",'{\n\t"data": "'+base64.encode('{"version":3,"rank":"guest","usedskips":0,"skipsleft":1,"discord":"unset","giveaways":["none"],"developer":0,"moderator":0,"owner":0,"vip":0}')+'"\n}'),msg.reply("Reset complete.")}catch(e){msg.reply("Cannot wipe user that does not exist!"),console.log(e)}}),c.on("write",(tokens,msg)=>{tokens.length<4&&msg.reply("You need more arguments");for(var i=2;i<tokens.length;i+=2)isNaN(tokens[i+1])?null==writeField("./database/"+tokens[1].toLowerCase()+".json",tokens[i],tokens[i+1])&&msg.reply("That user doesn't exist"):null==writeField("./database/"+tokens[1].toLowerCase()+".json",tokens[i],+tokens[i+1])&&msg.reply("That user doesn't exist")}),client.on("ready",()=>{console.log("Logged in")}),client.login(token);